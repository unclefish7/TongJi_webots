# éƒ¨ç½²æ¶æ„å›¾

æœ¬æ–‡æ¡£å±•ç¤ºäº†æ™ºèƒ½é…é€æœºå™¨äººç³»ç»Ÿçš„éƒ¨ç½²æ¶æ„å’Œç¯å¢ƒé…ç½®ã€‚

## 1. ç³»ç»Ÿéƒ¨ç½²æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              éƒ¨ç½²æ¶æ„å›¾                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚                            è´Ÿè½½å‡è¡¡å±‚                                           â”‚ â”‚
â”‚ â”‚                        Load Balancer Layer                                     â”‚ â”‚
â”‚ â”‚                                                                                 â”‚ â”‚
â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚ â”‚
â”‚ â”‚  â”‚   Nginx     â”‚    â”‚   HAProxy   â”‚    â”‚     CDN     â”‚    â”‚   SSLç»ˆç«¯   â”‚      â”‚ â”‚
â”‚ â”‚  â”‚åå‘ä»£ç†æœåŠ¡  â”‚    â”‚è´Ÿè½½å‡è¡¡å™¨    â”‚    â”‚å†…å®¹åˆ†å‘ç½‘ç»œ  â”‚    â”‚  SSL Term   â”‚      â”‚ â”‚
â”‚ â”‚  â”‚             â”‚    â”‚             â”‚    â”‚             â”‚    â”‚             â”‚      â”‚ â”‚
â”‚ â”‚  â”‚ - é™æ€æ–‡ä»¶   â”‚    â”‚ - å¥åº·æ£€æŸ¥   â”‚    â”‚ - é™æ€èµ„æº   â”‚    â”‚ - HTTPS     â”‚      â”‚ â”‚
â”‚ â”‚  â”‚ - è¯·æ±‚è·¯ç”±   â”‚    â”‚ - æ•…éšœè½¬ç§»   â”‚    â”‚ - å›¾ç‰‡/è§†é¢‘  â”‚    â”‚ - è¯ä¹¦ç®¡ç†   â”‚      â”‚ â”‚
â”‚ â”‚  â”‚ - ç¼“å­˜      â”‚    â”‚ - ä¼šè¯ä¿æŒ   â”‚    â”‚ - å…¨çƒåŠ é€Ÿ   â”‚    â”‚ - å®‰å…¨ç­–ç•¥   â”‚      â”‚ â”‚
â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                       â”‚                                             â”‚
â”‚                                       â–¼                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚                            åº”ç”¨æœåŠ¡å±‚                                           â”‚ â”‚
â”‚ â”‚                        Application Service Layer                               â”‚ â”‚
â”‚ â”‚                                                                                 â”‚ â”‚
â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚ â”‚
â”‚ â”‚  â”‚  Webå‰ç«¯    â”‚    â”‚  APIæœåŠ¡    â”‚    â”‚  WebSocket  â”‚    â”‚  è¯­éŸ³æœåŠ¡    â”‚      â”‚ â”‚
â”‚ â”‚  â”‚ Frontend    â”‚    â”‚ API Server  â”‚    â”‚   æœåŠ¡      â”‚    â”‚Voice Serviceâ”‚      â”‚ â”‚
â”‚ â”‚  â”‚             â”‚    â”‚             â”‚    â”‚             â”‚    â”‚             â”‚      â”‚ â”‚
â”‚ â”‚  â”‚ - Vue.js    â”‚    â”‚ - FastAPI   â”‚    â”‚ - å®æ—¶é€šä¿¡   â”‚    â”‚ - Vosk ASR  â”‚      â”‚ â”‚
â”‚ â”‚  â”‚ - TypeScriptâ”‚    â”‚ - Python    â”‚    â”‚ - çŠ¶æ€æ¨é€   â”‚    â”‚ - TTSåˆæˆ   â”‚      â”‚ â”‚
â”‚ â”‚  â”‚ - Viteæ„å»º  â”‚    â”‚ - å¼‚æ­¥å¤„ç†   â”‚    â”‚ - è¿æ¥ç®¡ç†   â”‚    â”‚ - è¯­éŸ³å¤„ç†   â”‚      â”‚ â”‚
â”‚ â”‚  â”‚ - NginxæœåŠ¡ â”‚    â”‚ - JWTè®¤è¯   â”‚    â”‚ - æ¶ˆæ¯å¹¿æ’­   â”‚    â”‚ - æŒ‡ä»¤è¯†åˆ«   â”‚      â”‚ â”‚
â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ â”‚
â”‚ â”‚                                                                                 â”‚ â”‚
â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚ â”‚
â”‚ â”‚  â”‚  ä»»åŠ¡ç®¡ç†    â”‚    â”‚  è·¯å¾„è§„åˆ’    â”‚    â”‚  å®‰å…¨ç›‘æ§    â”‚    â”‚  æ•°æ®åˆ†æ    â”‚      â”‚ â”‚
â”‚ â”‚  â”‚TaskManager  â”‚    â”‚PathPlanner  â”‚    â”‚SecurityMonitorâ”‚  â”‚DataAnalyzer â”‚      â”‚ â”‚
â”‚ â”‚  â”‚             â”‚    â”‚             â”‚    â”‚             â”‚    â”‚             â”‚      â”‚ â”‚
â”‚ â”‚  â”‚ - è°ƒåº¦ç®—æ³•   â”‚    â”‚ - A*ç®—æ³•    â”‚    â”‚ - å¼‚å¸¸æ£€æµ‹   â”‚    â”‚ - ç»Ÿè®¡åˆ†æ   â”‚      â”‚ â”‚
â”‚ â”‚  â”‚ - é˜Ÿåˆ—ç®¡ç†   â”‚    â”‚ - åœ°å›¾æœåŠ¡   â”‚    â”‚ - å…¥ä¾µæ£€æµ‹   â”‚    â”‚ - æŠ¥è¡¨ç”Ÿæˆ   â”‚      â”‚ â”‚
â”‚ â”‚  â”‚ - çŠ¶æ€è·Ÿè¸ª   â”‚    â”‚ - é¿éšœç®—æ³•   â”‚    â”‚ - å®¡è®¡æ—¥å¿—   â”‚    â”‚ - é¢„æµ‹åˆ†æ   â”‚      â”‚ â”‚
â”‚ â”‚  â”‚ - ä¼˜å…ˆçº§    â”‚    â”‚ - ä¼˜åŒ–ç®—æ³•   â”‚    â”‚ - å‘Šè­¦é€šçŸ¥   â”‚    â”‚ - å¯è§†åŒ–    â”‚      â”‚ â”‚
â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                       â”‚                                             â”‚
â”‚                                       â–¼                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚                           ROS2é€šä¿¡å±‚                                            â”‚ â”‚
â”‚ â”‚                        ROS2 Communication Layer                                â”‚ â”‚
â”‚ â”‚                                                                                 â”‚ â”‚
â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚ â”‚
â”‚ â”‚  â”‚  ROS2æ¡¥æ¥   â”‚    â”‚  å¯¼èˆªæ ˆ     â”‚    â”‚  SLAMç³»ç»Ÿ   â”‚    â”‚  ä¼ æ„Ÿå™¨èåˆ  â”‚      â”‚ â”‚
â”‚ â”‚  â”‚ROS2 Bridge  â”‚    â”‚Nav2 Stack   â”‚    â”‚SLAM System  â”‚    â”‚SensorFusion â”‚      â”‚ â”‚
â”‚ â”‚  â”‚             â”‚    â”‚             â”‚    â”‚             â”‚    â”‚             â”‚      â”‚ â”‚
â”‚ â”‚  â”‚ - æ¶ˆæ¯è½¬æ¢   â”‚    â”‚ - è·¯å¾„è§„åˆ’   â”‚    â”‚ - åœ°å›¾æ„å»º   â”‚    â”‚ - æ•°æ®èåˆ   â”‚      â”‚ â”‚
â”‚ â”‚  â”‚ - è¯é¢˜ä»£ç†   â”‚    â”‚ - å±€éƒ¨è§„åˆ’   â”‚    â”‚ - å®šä½ç®—æ³•   â”‚    â”‚ - ä¼ æ„Ÿå™¨æ ¡å‡† â”‚      â”‚ â”‚
â”‚ â”‚  â”‚ - æœåŠ¡è°ƒç”¨   â”‚    â”‚ - æ§åˆ¶å™¨    â”‚    â”‚ - å›ç¯æ£€æµ‹   â”‚    â”‚ - æ•…éšœæ£€æµ‹   â”‚      â”‚ â”‚
â”‚ â”‚  â”‚ - å‚æ•°ç®¡ç†   â”‚    â”‚ - æ¢å¤è¡Œä¸º   â”‚    â”‚ - åœ°å›¾æ›´æ–°   â”‚    â”‚ - æ•°æ®æ»¤æ³¢   â”‚      â”‚ â”‚
â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                       â”‚                                             â”‚
â”‚                                       â–¼                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚                          ä»¿çœŸç¯å¢ƒå±‚                                             â”‚ â”‚
â”‚ â”‚                       Simulation Environment Layer                             â”‚ â”‚
â”‚ â”‚                                                                                 â”‚ â”‚
â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚ â”‚
â”‚ â”‚  â”‚ Webotsä»¿çœŸ  â”‚    â”‚  æœºå™¨äººæ¨¡å‹  â”‚    â”‚  ç¯å¢ƒæ¨¡å‹    â”‚    â”‚  ä¼ æ„Ÿå™¨æ¨¡æ‹Ÿ  â”‚      â”‚ â”‚
â”‚ â”‚  â”‚Webots Sim   â”‚    â”‚Robot Model  â”‚    â”‚World Model  â”‚    â”‚Sensor Sim   â”‚      â”‚ â”‚
â”‚ â”‚  â”‚             â”‚    â”‚             â”‚    â”‚             â”‚    â”‚             â”‚      â”‚ â”‚
â”‚ â”‚  â”‚ - ç‰©ç†å¼•æ“   â”‚    â”‚ - è¿åŠ¨å­¦    â”‚    â”‚ - å»ºç­‘å¸ƒå±€   â”‚    â”‚ - LiDARä»¿çœŸ â”‚      â”‚ â”‚
â”‚ â”‚  â”‚ - å›¾å½¢æ¸²æŸ“   â”‚    â”‚ - åŠ¨åŠ›å­¦    â”‚    â”‚ - éšœç¢ç‰©    â”‚    â”‚ - æ‘„åƒå¤´ä»¿çœŸ â”‚      â”‚ â”‚
â”‚ â”‚  â”‚ - åœºæ™¯ç®¡ç†   â”‚    â”‚ - å¤–è§‚è®¾è®¡   â”‚    â”‚ - æè´¨å±æ€§   â”‚    â”‚ - IMUä»¿çœŸ   â”‚      â”‚ â”‚
â”‚ â”‚  â”‚ - æ—¶é—´åŒæ­¥   â”‚    â”‚ - ä¼ æ„Ÿå™¨é›†æˆ â”‚    â”‚ - å…‰ç…§æ•ˆæœ   â”‚    â”‚ - å™ªå£°æ¨¡æ‹Ÿ   â”‚      â”‚ â”‚
â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                       â”‚                                             â”‚
â”‚                                       â–¼                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚                           æ•°æ®å­˜å‚¨å±‚                                            â”‚ â”‚
â”‚ â”‚                        Data Storage Layer                                      â”‚ â”‚
â”‚ â”‚                                                                                 â”‚ â”‚
â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚ â”‚
â”‚ â”‚  â”‚ SQLiteæ•°æ®åº“â”‚    â”‚  Redisç¼“å­˜  â”‚    â”‚  æ–‡ä»¶å­˜å‚¨    â”‚    â”‚  æ—¥å¿—ç³»ç»Ÿ    â”‚      â”‚ â”‚
â”‚ â”‚  â”‚SQLite DB    â”‚    â”‚Redis Cache  â”‚    â”‚File Storage â”‚    â”‚Log System   â”‚      â”‚ â”‚
â”‚ â”‚  â”‚             â”‚    â”‚             â”‚    â”‚             â”‚    â”‚             â”‚      â”‚ â”‚
â”‚ â”‚  â”‚ - ä»»åŠ¡æ•°æ®   â”‚    â”‚ - ä¼šè¯ç¼“å­˜   â”‚    â”‚ - é…ç½®æ–‡ä»¶   â”‚    â”‚ - æ“ä½œæ—¥å¿—   â”‚      â”‚ â”‚
â”‚ â”‚  â”‚ - ç”¨æˆ·æ•°æ®   â”‚    â”‚ - æŸ¥è¯¢ç¼“å­˜   â”‚    â”‚ - åœ°å›¾æ–‡ä»¶   â”‚    â”‚ - é”™è¯¯æ—¥å¿—   â”‚      â”‚ â”‚
â”‚ â”‚  â”‚ - ç³»ç»Ÿé…ç½®   â”‚    â”‚ - ä¸´æ—¶æ•°æ®   â”‚    â”‚ - åª’ä½“æ–‡ä»¶   â”‚    â”‚ - è®¿é—®æ—¥å¿—   â”‚      â”‚ â”‚
â”‚ â”‚  â”‚ - å†å²è®°å½•   â”‚    â”‚ - çŠ¶æ€æ•°æ®   â”‚    â”‚ - å¤‡ä»½æ–‡ä»¶   â”‚    â”‚ - æ€§èƒ½æ—¥å¿—   â”‚      â”‚ â”‚
â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚                           ç›‘æ§å‘Šè­¦å±‚                                            â”‚ â”‚
â”‚ â”‚                        Monitoring & Alerting Layer                             â”‚ â”‚
â”‚ â”‚                                                                                 â”‚ â”‚
â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚ â”‚
â”‚ â”‚  â”‚ æ€§èƒ½ç›‘æ§    â”‚    â”‚  å¥åº·æ£€æŸ¥    â”‚    â”‚  æ—¥å¿—èšåˆ    â”‚    â”‚  å‘Šè­¦é€šçŸ¥    â”‚      â”‚ â”‚
â”‚ â”‚  â”‚Performance  â”‚    â”‚Health Check â”‚    â”‚Log Aggregateâ”‚    â”‚Alert Notify â”‚      â”‚ â”‚
â”‚ â”‚  â”‚             â”‚    â”‚             â”‚    â”‚             â”‚    â”‚             â”‚      â”‚ â”‚
â”‚ â”‚  â”‚ - CPU/å†…å­˜  â”‚    â”‚ - æœåŠ¡çŠ¶æ€   â”‚    â”‚ - æ—¥å¿—æ”¶é›†   â”‚    â”‚ - é‚®ä»¶é€šçŸ¥   â”‚      â”‚ â”‚
â”‚ â”‚  â”‚ - ç½‘ç»œI/O   â”‚    â”‚ - æ¥å£æ£€æŸ¥   â”‚    â”‚ - æ—¥å¿—åˆ†æ   â”‚    â”‚ - çŸ­ä¿¡é€šçŸ¥   â”‚      â”‚ â”‚
â”‚ â”‚  â”‚ - æ•°æ®åº“æ€§èƒ½ â”‚    â”‚ - ä¾èµ–æ£€æŸ¥   â”‚    â”‚ - å¼‚å¸¸æ£€æµ‹   â”‚    â”‚ - é’‰é’‰é€šçŸ¥   â”‚      â”‚ â”‚
â”‚ â”‚  â”‚ - å“åº”æ—¶é—´   â”‚    â”‚ - èµ„æºæ£€æŸ¥   â”‚    â”‚ - è¶‹åŠ¿åˆ†æ   â”‚    â”‚ - å‡çº§æœºåˆ¶   â”‚      â”‚ â”‚
â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 2. å®¹å™¨åŒ–éƒ¨ç½²æ¶æ„

### 2.1 Dockerå®¹å™¨ç»„ç»‡ç»“æ„

```yaml
# docker-compose.yml
version: '3.8'

services:
  # å‰ç«¯æœåŠ¡
  frontend:
    build: ./robot-delivery-system
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - VITE_API_BASE_URL=http://api:8000
    depends_on:
      - api
    networks:
      - app-network
    volumes:
      - ./robot-delivery-system/dist:/usr/share/nginx/html:ro
    restart: unless-stopped

  # APIæœåŠ¡
  api:
    build: ./secure_robot_api
    ports:
      - "8000:8000"
    environment:
      - DATABASE_URL=sqlite:///./storage/robot_delivery.db
      - REDIS_URL=redis://redis:6379
      - JWT_SECRET_KEY=${JWT_SECRET_KEY}
      - ROS_DOMAIN_ID=${ROS_DOMAIN_ID}
    depends_on:
      - redis
      - db
    networks:
      - app-network
      - ros-network
    volumes:
      - ./secure_robot_api/storage:/app/storage
      - ./secure_robot_api/logs:/app/logs
    restart: unless-stopped

  # Redisç¼“å­˜
  redis:
    image: redis:6-alpine
    ports:
      - "6379:6379"
    command: redis-server --appendonly yes
    networks:
      - app-network
    volumes:
      - redis-data:/data
    restart: unless-stopped

  # æ•°æ®åº“
  db:
    image: sqlite:latest
    networks:
      - app-network
    volumes:
      - db-data:/var/lib/sqlite
    restart: unless-stopped

  # ROS2æœåŠ¡
  ros2-bridge:
    build: ./ros2_ws
    environment:
      - ROS_DOMAIN_ID=${ROS_DOMAIN_ID}
      - RMW_IMPLEMENTATION=rmw_fastrtps_cpp
    networks:
      - ros-network
    volumes:
      - ./ros2_ws/src:/ros2_ws/src
      - ./ros2_ws/install:/ros2_ws/install
    restart: unless-stopped

  # Webotsä»¿çœŸ
  webots:
    build: ./tongji_webot_project
    ports:
      - "1234:1234"  # Webotsç«¯å£
    environment:
      - DISPLAY=${DISPLAY}
      - WEBOTS_HOME=/usr/local/webots
    networks:
      - ros-network
    volumes:
      - /tmp/.X11-unix:/tmp/.X11-unix:rw
      - ./tongji_webot_project/worlds:/usr/local/webots/projects/worlds
    restart: unless-stopped

  # ç›‘æ§æœåŠ¡
  prometheus:
    image: prom/prometheus
    ports:
      - "9090:9090"
    networks:
      - monitoring
    volumes:
      - ./monitoring/prometheus.yml:/etc/prometheus/prometheus.yml
      - prometheus-data:/prometheus
    restart: unless-stopped

  # å¯è§†åŒ–ç›‘æ§
  grafana:
    image: grafana/grafana
    ports:
      - "3001:3000"
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=${GRAFANA_PASSWORD}
    networks:
      - monitoring
    volumes:
      - grafana-data:/var/lib/grafana
      - ./monitoring/grafana:/etc/grafana/provisioning
    restart: unless-stopped

  # è´Ÿè½½å‡è¡¡
  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    networks:
      - app-network
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf
      - ./nginx/ssl:/etc/nginx/ssl
      - ./nginx/logs:/var/log/nginx
    depends_on:
      - frontend
      - api
    restart: unless-stopped

networks:
  app-network:
    driver: bridge
  ros-network:
    driver: bridge
  monitoring:
    driver: bridge

volumes:
  redis-data:
  db-data:
  prometheus-data:
  grafana-data:
```

### 2.2 Kuberneteséƒ¨ç½²é…ç½®

```yaml
# k8s-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: robot-delivery-api
  namespace: robot-system
spec:
  replicas: 3
  selector:
    matchLabels:
      app: robot-delivery-api
  template:
    metadata:
      labels:
        app: robot-delivery-api
    spec:
      containers:
      - name: api
        image: robot-delivery/api:latest
        ports:
        - containerPort: 8000
        env:
        - name: DATABASE_URL
          valueFrom:
            secretKeyRef:
              name: db-secret
              key: url
        - name: REDIS_URL
          value: "redis://redis-service:6379"
        resources:
          requests:
            memory: "512Mi"
            cpu: "250m"
          limits:
            memory: "1Gi"
            cpu: "500m"
        livenessProbe:
          httpGet:
            path: /health
            port: 8000
          initialDelaySeconds: 30
          periodSeconds: 10
        readinessProbe:
          httpGet:
            path: /ready
            port: 8000
          initialDelaySeconds: 5
          periodSeconds: 5

---
apiVersion: v1
kind: Service
metadata:
  name: api-service
  namespace: robot-system
spec:
  selector:
    app: robot-delivery-api
  ports:
  - port: 8000
    targetPort: 8000
  type: ClusterIP

---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: robot-delivery-ingress
  namespace: robot-system
  annotations:
    kubernetes.io/ingress.class: nginx
    cert-manager.io/cluster-issuer: letsencrypt-prod
spec:
  tls:
  - hosts:
    - api.robot-delivery.com
    secretName: api-tls
  rules:
  - host: api.robot-delivery.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: api-service
            port:
              number: 8000
```

## 3. ç¯å¢ƒé…ç½®ç®¡ç†

### 3.1 å¤šç¯å¢ƒé…ç½®

```bash
# å¼€å‘ç¯å¢ƒ (.env.dev)
NODE_ENV=development
API_BASE_URL=http://localhost:8000
DATABASE_URL=sqlite:///./dev.db
REDIS_URL=redis://localhost:6379
LOG_LEVEL=DEBUG
WEBOTS_MODE=development

# æµ‹è¯•ç¯å¢ƒ (.env.test)
NODE_ENV=test
API_BASE_URL=http://test-api.internal:8000
DATABASE_URL=sqlite:///./test.db
REDIS_URL=redis://test-redis.internal:6379
LOG_LEVEL=INFO
WEBOTS_MODE=test

# ç”Ÿäº§ç¯å¢ƒ (.env.prod)
NODE_ENV=production
API_BASE_URL=https://api.robot-delivery.com
DATABASE_URL=postgresql://user:pass@prod-db.internal:5432/robot_delivery
REDIS_URL=redis://prod-redis.internal:6379
LOG_LEVEL=WARNING
WEBOTS_MODE=production
```

### 3.2 é…ç½®ç®¡ç†è„šæœ¬

```python
# config/environment.py
import os
from typing import Dict, Any
from dataclasses import dataclass

@dataclass
class DatabaseConfig:
    url: str
    pool_size: int = 10
    max_overflow: int = 20
    pool_timeout: int = 30

@dataclass
class RedisConfig:
    url: str
    max_connections: int = 100
    socket_timeout: int = 5

@dataclass
class ROS2Config:
    domain_id: int
    middleware: str = "rmw_fastrtps_cpp"
    discovery_timeout: int = 30

class Environment:
    def __init__(self, env_name: str = None):
        self.env_name = env_name or os.getenv('NODE_ENV', 'development')
        self.load_config()
    
    def load_config(self):
        """åŠ è½½ç¯å¢ƒé…ç½®"""
        config_file = f".env.{self.env_name}"
        if os.path.exists(config_file):
            self.load_env_file(config_file)
        
        self.database = DatabaseConfig(
            url=os.getenv('DATABASE_URL', 'sqlite:///./robot_delivery.db')
        )
        
        self.redis = RedisConfig(
            url=os.getenv('REDIS_URL', 'redis://localhost:6379')
        )
        
        self.ros2 = ROS2Config(
            domain_id=int(os.getenv('ROS_DOMAIN_ID', '0'))
        )
    
    def load_env_file(self, file_path: str):
        """åŠ è½½ç¯å¢ƒå˜é‡æ–‡ä»¶"""
        with open(file_path, 'r') as f:
            for line in f:
                if '=' in line and not line.startswith('#'):
                    key, value = line.strip().split('=', 1)
                    os.environ[key] = value

# å…¨å±€é…ç½®å®ä¾‹
config = Environment()
```

## 4. éƒ¨ç½²è„šæœ¬å’Œè‡ªåŠ¨åŒ–

### 4.1 ä¸€é”®éƒ¨ç½²è„šæœ¬

```bash
#!/bin/bash
# deploy.sh - ä¸€é”®éƒ¨ç½²è„šæœ¬

set -e

# é…ç½®å˜é‡
ENVIRONMENT=${1:-production}
VERSION=${2:-latest}
DEPLOY_DIR="/opt/robot-delivery"
BACKUP_DIR="/opt/backups"

echo "å¼€å§‹éƒ¨ç½²æ™ºèƒ½é…é€æœºå™¨äººç³»ç»Ÿ..."
echo "ç¯å¢ƒ: $ENVIRONMENT"
echo "ç‰ˆæœ¬: $VERSION"

# æ£€æŸ¥ç³»ç»Ÿè¦æ±‚
check_requirements() {
    echo "æ£€æŸ¥ç³»ç»Ÿè¦æ±‚..."
    
    # æ£€æŸ¥Docker
    if ! command -v docker &> /dev/null; then
        echo "é”™è¯¯: Dockeræœªå®‰è£…"
        exit 1
    fi
    
    # æ£€æŸ¥Docker Compose
    if ! command -v docker-compose &> /dev/null; then
        echo "é”™è¯¯: Docker Composeæœªå®‰è£…"
        exit 1
    fi
    
    # æ£€æŸ¥ç£ç›˜ç©ºé—´
    AVAILABLE_SPACE=$(df / | tail -1 | awk '{print $4}')
    if [ $AVAILABLE_SPACE -lt 5000000 ]; then
        echo "è­¦å‘Š: ç£ç›˜ç©ºé—´ä¸è¶³5GB"
    fi
    
    echo "ç³»ç»Ÿè¦æ±‚æ£€æŸ¥å®Œæˆ"
}

# å¤‡ä»½ç°æœ‰æ•°æ®
backup_data() {
    echo "å¤‡ä»½ç°æœ‰æ•°æ®..."
    
    if [ -d "$DEPLOY_DIR" ]; then
        TIMESTAMP=$(date +%Y%m%d_%H%M%S)
        BACKUP_PATH="$BACKUP_DIR/backup_$TIMESTAMP"
        
        mkdir -p "$BACKUP_PATH"
        
        # å¤‡ä»½æ•°æ®åº“
        if [ -f "$DEPLOY_DIR/storage/robot_delivery.db" ]; then
            cp "$DEPLOY_DIR/storage/robot_delivery.db" "$BACKUP_PATH/"
        fi
        
        # å¤‡ä»½é…ç½®æ–‡ä»¶
        if [ -f "$DEPLOY_DIR/.env" ]; then
            cp "$DEPLOY_DIR/.env" "$BACKUP_PATH/"
        fi
        
        echo "æ•°æ®å¤‡ä»½åˆ°: $BACKUP_PATH"
    fi
}

# ä¸‹è½½å’Œæ›´æ–°ä»£ç 
update_code() {
    echo "æ›´æ–°ä»£ç ..."
    
    if [ ! -d "$DEPLOY_DIR" ]; then
        mkdir -p "$DEPLOY_DIR"
        cd "$DEPLOY_DIR"
        git clone https://github.com/your-org/robot-delivery-system.git .
    else
        cd "$DEPLOY_DIR"
        git fetch origin
        git checkout $VERSION
        git pull origin $VERSION
    fi
    
    echo "ä»£ç æ›´æ–°å®Œæˆ"
}

# æ„å»ºå’Œéƒ¨ç½²æœåŠ¡
deploy_services() {
    echo "æ„å»ºå’Œéƒ¨ç½²æœåŠ¡..."
    
    cd "$DEPLOY_DIR"
    
    # å¤åˆ¶ç¯å¢ƒé…ç½®
    cp ".env.$ENVIRONMENT" ".env"
    
    # æ„å»ºé•œåƒ
    docker-compose build
    
    # åœæ­¢æ—§æœåŠ¡
    docker-compose down
    
    # å¯åŠ¨æ–°æœåŠ¡
    docker-compose up -d
    
    echo "æœåŠ¡éƒ¨ç½²å®Œæˆ"
}

# å¥åº·æ£€æŸ¥
health_check() {
    echo "æ‰§è¡Œå¥åº·æ£€æŸ¥..."
    
    # ç­‰å¾…æœåŠ¡å¯åŠ¨
    sleep 30
    
    # æ£€æŸ¥APIæœåŠ¡
    if curl -f http://localhost:8000/health > /dev/null 2>&1; then
        echo "âœ“ APIæœåŠ¡æ­£å¸¸"
    else
        echo "âœ— APIæœåŠ¡å¼‚å¸¸"
        exit 1
    fi
    
    # æ£€æŸ¥å‰ç«¯æœåŠ¡
    if curl -f http://localhost:3000 > /dev/null 2>&1; then
        echo "âœ“ å‰ç«¯æœåŠ¡æ­£å¸¸"
    else
        echo "âœ— å‰ç«¯æœåŠ¡å¼‚å¸¸"
        exit 1
    fi
    
    # æ£€æŸ¥æ•°æ®åº“è¿æ¥
    if docker-compose exec -T api python -c "from app.database import test_connection; test_connection()" > /dev/null 2>&1; then
        echo "âœ“ æ•°æ®åº“è¿æ¥æ­£å¸¸"
    else
        echo "âœ— æ•°æ®åº“è¿æ¥å¼‚å¸¸"
        exit 1
    fi
    
    echo "å¥åº·æ£€æŸ¥é€šè¿‡"
}

# æ¸…ç†æ—§ç‰ˆæœ¬
cleanup() {
    echo "æ¸…ç†æ—§ç‰ˆæœ¬..."
    
    # æ¸…ç†æ—§é•œåƒ
    docker image prune -f
    
    # æ¸…ç†æ—§å®¹å™¨
    docker container prune -f
    
    # æ¸…ç†æ—§å¤‡ä»½(ä¿ç•™æœ€è¿‘10ä¸ª)
    if [ -d "$BACKUP_DIR" ]; then
        ls -t "$BACKUP_DIR" | tail -n +11 | xargs -I {} rm -rf "$BACKUP_DIR/{}"
    fi
    
    echo "æ¸…ç†å®Œæˆ"
}

# ä¸»æµç¨‹
main() {
    check_requirements
    backup_data
    update_code
    deploy_services
    health_check
    cleanup
    
    echo "ğŸ‰ éƒ¨ç½²å®Œæˆ!"
    echo "è®¿é—®åœ°å€:"
    echo "  å‰ç«¯: http://localhost:3000"
    echo "  API: http://localhost:8000"
    echo "  ç›‘æ§: http://localhost:3001"
}

# é”™è¯¯å¤„ç†
trap 'echo "âŒ éƒ¨ç½²å¤±è´¥!"; exit 1' ERR

# æ‰§è¡Œä¸»æµç¨‹
main
```

### 4.2 CI/CDæµæ°´çº¿é…ç½®

```yaml
# .github/workflows/deploy.yml
name: Deploy Robot Delivery System

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    
    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
    
    - name: Install dependencies
      run: |
        cd secure_robot_api
        pip install -r requirements.txt
    
    - name: Run tests
      run: |
        cd secure_robot_api
        pytest tests/ -v --cov=app --cov-report=xml
    
    - name: Upload coverage
      uses: codecov/codecov-action@v3
      with:
        file: ./secure_robot_api/coverage.xml

  build:
    needs: test
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
    
    - name: Build frontend
      run: |
        cd robot-delivery-system
        npm install
        npm run build
    
    - name: Build Docker images
      run: |
        docker build -t robot-delivery/api:${{ github.sha }} ./secure_robot_api
        docker build -t robot-delivery/frontend:${{ github.sha }} ./robot-delivery-system
    
    - name: Push to registry
      run: |
        echo ${{ secrets.DOCKER_PASSWORD }} | docker login -u ${{ secrets.DOCKER_USERNAME }} --password-stdin
        docker push robot-delivery/api:${{ github.sha }}
        docker push robot-delivery/frontend:${{ github.sha }}

  deploy:
    needs: build
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    steps:
    - uses: actions/checkout@v3
    
    - name: Deploy to staging
      run: |
        ssh ${{ secrets.DEPLOY_USER }}@${{ secrets.DEPLOY_HOST }} "
          cd /opt/robot-delivery &&
          ./deploy.sh staging ${{ github.sha }}
        "
    
    - name: Run integration tests
      run: |
        # é›†æˆæµ‹è¯•è„šæœ¬
        ./scripts/integration_test.sh staging
    
    - name: Deploy to production
      if: success()
      run: |
        ssh ${{ secrets.DEPLOY_USER }}@${{ secrets.DEPLOY_HOST }} "
          cd /opt/robot-delivery &&
          ./deploy.sh production ${{ github.sha }}
        "
```

## 5. æ€§èƒ½ä¼˜åŒ–å’Œæ‰©å±•

### 5.1 æ°´å¹³æ‰©å±•é…ç½®

```yaml
# horizontal-scaling.yml
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: api-hpa
  namespace: robot-system
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: robot-delivery-api
  minReplicas: 2
  maxReplicas: 10
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 70
  - type: Resource
    resource:
      name: memory
      target:
        type: Utilization
        averageUtilization: 80
  behavior:
    scaleUp:
      stabilizationWindowSeconds: 60
      policies:
      - type: Percent
        value: 100
        periodSeconds: 15
    scaleDown:
      stabilizationWindowSeconds: 300
      policies:
      - type: Percent
        value: 10
        periodSeconds: 60
```

### 5.2 æ•°æ®åº“é›†ç¾¤é…ç½®

```yaml
# postgres-cluster.yml
apiVersion: postgresql.cnpg.io/v1
kind: Cluster
metadata:
  name: postgres-cluster
  namespace: robot-system
spec:
  instances: 3
  primaryUpdateStrategy: unsupervised
  
  postgresql:
    parameters:
      max_connections: "200"
      shared_buffers: "256MB"
      effective_cache_size: "1GB"
      maintenance_work_mem: "64MB"
      checkpoint_completion_target: "0.9"
      wal_buffers: "16MB"
      default_statistics_target: "100"
      random_page_cost: "1.1"
      effective_io_concurrency: "200"
  
  bootstrap:
    initdb:
      database: robot_delivery
      owner: app_user
      secret:
        name: postgres-credentials
  
  storage:
    size: 100Gi
    storageClass: fast-ssd
  
  monitoring:
    enabled: true
```

## 6. å®‰å…¨åŠ å›º

### 6.1 ç½‘ç»œå®‰å…¨é…ç½®

```yaml
# network-policy.yml
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: robot-delivery-network-policy
  namespace: robot-system
spec:
  podSelector:
    matchLabels:
      app: robot-delivery-api
  policyTypes:
  - Ingress
  - Egress
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          name: ingress-nginx
    - podSelector:
        matchLabels:
          app: robot-delivery-frontend
    ports:
    - protocol: TCP
      port: 8000
  egress:
  - to:
    - podSelector:
        matchLabels:
          app: postgres
    ports:
    - protocol: TCP
      port: 5432
  - to:
    - podSelector:
        matchLabels:
          app: redis
    ports:
    - protocol: TCP
      port: 6379
```

### 6.2 å¯†é’¥ç®¡ç†

```yaml
# sealed-secrets.yml
apiVersion: bitnami.com/v1alpha1
kind: SealedSecret
metadata:
  name: robot-delivery-secrets
  namespace: robot-system
spec:
  encryptedData:
    database-url: AgBy3i4OJSWK+PiTySYZZA9rO5...
    jwt-secret: AgAKAoiQm+/LCCmqmcb09b5Sx...
    redis-password: AgAoKpEHpNvX8KmLc5fEqO8Lf...
  template:
    metadata:
      name: robot-delivery-secrets
      namespace: robot-system
    type: Opaque
```

è¿™æ ·ï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº†å®Œæ•´çš„éƒ¨ç½²æ¶æ„å›¾æ–‡æ¡£ï¼Œæ¶µç›–äº†ä»å•æœºéƒ¨ç½²åˆ°å®¹å™¨åŒ–ã€Kubernetesé›†ç¾¤éƒ¨ç½²çš„å„ç§åœºæ™¯ï¼ŒåŒ…æ‹¬ç›‘æ§ã€å®‰å…¨ã€æ‰©å±•ç­‰å„ä¸ªæ–¹é¢çš„é…ç½®ã€‚
