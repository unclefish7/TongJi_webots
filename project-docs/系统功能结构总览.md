# 📦 智能配送机器人管理系统 — 功能总览

---

## 🌐 一、系统概览

该系统面向室内环境中的物品配送需求，集成了 ROS 2 机器人调度控制、Webots 仿真、前后端可视化界面，实现了任务调度、身份认证、包裹寄送与取件等一体化功能，核心亮点为**多等级优先级调度算法与抢占机制**。

---

## 👤 二、身份认证模块

* 用户在进行呼叫、寄送、取件等操作前，需先通过身份认证。
* 认证等级划分：

  * **L1**：基础权限
  * **L2**：中等级权限
  * **L3**：高级权限
* 每次认证均有时间限制，取件页面会展示认证剩余时间。

---

## 🤖 三、机器人调度控制模块

### 1. 任务类型

* **呼叫任务**：将机器人派遣至指定地点。
* **寄件任务**：机器人取走包裹送至目标点，需用户在目标点完成取件操作。

### 2. 任务状态

* `等待中`：处于等待队列中，未开始执行。
* `执行中`：正在执行，机器人在前往目标地点。
* `已到达`：机器人已到达目标点（寄件任务仍需取件才算完成）。
* `完成`：任务完全结束（含寄件被成功取走）。
* `可跳过`：寄件任务到达目标点后超时未被取件，进入可跳过状态。

---

## 🧠 四、任务调度与抢占策略（核心）

### 1. 调度流程

* 点击“开始执行任务队列”：

  * 将当前优先级的任务加入执行队列
  * 并按加权打分排序后逐个执行
* 每完成一个任务后，需手动点击“继续下一个任务”推进下一个任务

### 2. 多因素加权排序（同等级任务内部排序）

如图示配置，优先级由以下因素加权计算：

| 因素     | 说明            | 权重（示例） |
| ------ | ------------- | ------ |
| 距离     | 与当前位置距离       | 1.0    |
| 等待时间   | 等待越久优先级越高     | 0.5    |
| 超时历史   | 曾被跳过的优先考虑     | 10.0   |
| 任务类型   | 寄送（send）优先于呼叫 | 2.0    |
| 原始任务等级 | 原始等级越高越优先     | 5.0    |

### 3. 抢占机制

* 若当前已有执行队列正在运行，点击“开始执行任务队列”将触发抢占逻辑：

  * 若有**更高优先级**任务 → 抢占执行，原任务退回等待队列
  * 若有**同等级新任务** → 重新排序，重新执行

---

## ⏱️ 五、超时处理机制（寄件任务）

* 机器人到达目标点后，等待用户取件
* 若 **超过10秒仍未取件** → 任务标记为“可跳过”
* 此时点击“继续下一个任务”将：

  * 跳过该任务并从执行队列移出
  * 任务放回等待队列：

    * **L1 任务降级为 L0**
    * **L2/L3 留在原等级等待队列中**

---

## 📦 六、包裹寄送模块

### 流程

1. 认证身份
2. 填写包裹信息、选择安全等级（L1/L2/L3）
3. 系统自动分配可用 locker 柜门
4. 生成任务，加入任务队列
5. 机器人执行任务，将包裹送至指定位置

---

## 📮 七、取件模块

### 流程

1. 认证身份进入取件页面
2. 若有包裹到达目标点 → 显示在界面中
3. 在有效时间内完成“取件认证”操作
4. 认证成功 → 柜门打开、包裹完成取件、释放 locker

---

## 🗺️ 八、界面模块功能

### 主界面

* 左侧任务队列（按等级分类）

  * `开始执行任务队列`：触发调度
  * `继续下一个任务`：手动推进下一个
* 实时地图：

  * 显示机器人位置、路径规划轨迹
  * 支持连接 ROS、重置视图等操作
* 柜门状态面板：显示 LOCKER 状态（可用/占用）

---

## ⚙️ 九、系统技术架构概览

* **前端**：Vue + Element UI + WebSocket 实时通信
* **后端**：FastAPI + ROS 2 bridge 节点
* **仿真平台**：Webots 场景模拟
* **调度逻辑**：Python 实现动态优先级计算、队列调度、抢占策略等
